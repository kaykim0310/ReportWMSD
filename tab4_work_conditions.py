import streamlit as st
import pandas as pd
from utils import get_ì‚¬ì—…ì¥ëª…_ëª©ë¡, get_íŒ€_ëª©ë¡, get_ì‘ì—…ëª…_ëª©ë¡, safe_convert, extract_number, calculate_total_score

def render_work_conditions_tab():
    """ì‘ì—…ì¡°ê±´ì¡°ì‚¬ íƒ­ ë Œë”ë§"""
    st.title("ì‘ì—…ì¡°ê±´ì¡°ì‚¬")
    
    # ê³„ì¸µì  ì„ íƒ êµ¬ì¡°
    col1, col2, col3 = st.columns(3)
    
    with col1:
        íšŒì‚¬ëª…_ëª©ë¡_ì¡°ê±´ = get_ì‚¬ì—…ì¥ëª…_ëª©ë¡()
        if not íšŒì‚¬ëª…_ëª©ë¡_ì¡°ê±´:
            st.warning("ë¨¼ì € ì²´í¬ë¦¬ìŠ¤íŠ¸ì— ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”.")
            selected_íšŒì‚¬ëª…_ì¡°ê±´ = None
        else:
            selected_íšŒì‚¬ëª…_ì¡°ê±´ = st.selectbox(
                "íšŒì‚¬ëª… ì„ íƒ",
                ["ì„ íƒí•˜ì„¸ìš”"] + íšŒì‚¬ëª…_ëª©ë¡_ì¡°ê±´,
                key="ì‘ì—…ì¡°ê±´_íšŒì‚¬ëª…"
            )
            if selected_íšŒì‚¬ëª…_ì¡°ê±´ == "ì„ íƒí•˜ì„¸ìš”":
                selected_íšŒì‚¬ëª…_ì¡°ê±´ = None
    
    with col2:
        if selected_íšŒì‚¬ëª…_ì¡°ê±´:
            ì†Œì†_ëª©ë¡_ì¡°ê±´ = get_íŒ€_ëª©ë¡(selected_íšŒì‚¬ëª…_ì¡°ê±´)
            selected_ì†Œì†_ì¡°ê±´ = st.selectbox(
                "ì†Œì† ì„ íƒ",
                ["ì „ì²´"] + ì†Œì†_ëª©ë¡_ì¡°ê±´,
                key="ì‘ì—…ì¡°ê±´_ì†Œì†"
            )
            if selected_ì†Œì†_ì¡°ê±´ == "ì „ì²´":
                selected_ì†Œì†_ì¡°ê±´ = None
        else:
            st.selectbox("ì†Œì† ì„ íƒ", ["íšŒì‚¬ëª…ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”"], disabled=True, key="ì‘ì—…ì¡°ê±´_ì†Œì†_disabled")
            selected_ì†Œì†_ì¡°ê±´ = None
    
    with col3:
        if selected_íšŒì‚¬ëª…_ì¡°ê±´:
            ì‘ì—…ëª…_ëª©ë¡_ì¡°ê±´ = get_ì‘ì—…ëª…_ëª©ë¡(selected_íšŒì‚¬ëª…_ì¡°ê±´, selected_ì†Œì†_ì¡°ê±´, None)
            if ì‘ì—…ëª…_ëª©ë¡_ì¡°ê±´:
                selected_ì‘ì—…ëª… = st.selectbox(
                    "ì‘ì—…ëª… ì„ íƒ",
                    ì‘ì—…ëª…_ëª©ë¡_ì¡°ê±´,
                    key="ì‘ì—…ì¡°ê±´_ì‘ì—…ëª…"
                )
            else:
                st.warning("í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.")
                selected_ì‘ì—…ëª… = None
        else:
            st.selectbox("ì‘ì—…ëª… ì„ íƒ", ["íšŒì‚¬ëª…ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”"], disabled=True, key="ì‘ì—…ì¡°ê±´_ì‘ì—…ëª…_disabled")
            selected_ì‘ì—…ëª… = None
    
    if selected_ì‘ì—…ëª…:
        ì‘ì—…ëª…_ëª©ë¡ = get_ì‘ì—…ëª…_ëª©ë¡(selected_íšŒì‚¬ëª…_ì¡°ê±´, selected_ì†Œì†_ì¡°ê±´, None)
        st.info(f"ğŸ“‹ ì„ íƒëœ ì‘ì—…: {selected_íšŒì‚¬ëª…_ì¡°ê±´} > {selected_ì†Œì†_ì¡°ê±´ or 'ì „ì²´'} > {selected_ì‘ì—…ëª…}")
        st.info(f"ğŸ“‹ ì´ {len(ì‘ì—…ëª…_ëª©ë¡)}ê°œì˜ ì‘ì—…ì´ ìˆìŠµë‹ˆë‹¤. ê° ì‘ì—…ë³„ë¡œ 1,2,3ë‹¨ê³„ë¥¼ ì‘ì„±í•˜ì„¸ìš”.")
        
        # ì„ íƒëœ ì‘ì—…ì— ëŒ€í•œ 1,2,3ë‹¨ê³„
        with st.container():
            # 1ë‹¨ê³„: ìœ í•´ìš”ì¸ ê¸°ë³¸ì¡°ì‚¬
            st.subheader(f"1ë‹¨ê³„: ìœ í•´ìš”ì¸ ê¸°ë³¸ì¡°ì‚¬ - [{selected_ì‘ì—…ëª…}]")
            
            # ì—‘ì…€ì—ì„œ ì‘ì—…ë‚´ìš©(ìƒì„¸ì„¤ëª…) ê°€ì ¸ì˜¤ê¸°
            ì‘ì—…ë‚´ìš©_ìƒì„¸ì„¤ëª… = ""
            if not st.session_state["checklist_df"].empty:
                ì‘ì—…_ë°ì´í„° = st.session_state["checklist_df"][
                    (st.session_state["checklist_df"]["ì‘ì—…ëª…"] == selected_ì‘ì—…ëª…) &
                    (st.session_state["checklist_df"]["íšŒì‚¬ëª…"] == selected_íšŒì‚¬ëª…_ì¡°ê±´)
                ]
                if selected_ì†Œì†_ì¡°ê±´:
                    ì‘ì—…_ë°ì´í„° = ì‘ì—…_ë°ì´í„°[ì‘ì—…_ë°ì´í„°["ì†Œì†"] == selected_ì†Œì†_ì¡°ê±´]
                
                if not ì‘ì—…_ë°ì´í„°.empty and "ì‘ì—…ë‚´ìš©(ìƒì„¸ì„¤ëª…)" in ì‘ì—…_ë°ì´í„°.columns:
                    # ì²« ë²ˆì§¸ í–‰ì˜ ì‘ì—…ë‚´ìš©(ìƒì„¸ì„¤ëª…) ì‚¬ìš©
                    raw_value = ì‘ì—…_ë°ì´í„°.iloc[0].get("ì‘ì—…ë‚´ìš©(ìƒì„¸ì„¤ëª…)", "")
                    ì‘ì—…ë‚´ìš©_ìƒì„¸ì„¤ëª… = safe_convert(raw_value, str, "")
                    if ì‘ì—…ë‚´ìš©_ìƒì„¸ì„¤ëª…:
                        st.success(f"âœ… ì‘ì—…ë‚´ìš© ìë™ ë¡œë“œë¨")
            
            col1, col2 = st.columns(2)
            with col1:
                ì‘ì—…ê³µì • = st.text_input("ì‘ì—…ê³µì •", value=selected_ì‘ì—…ëª…, key=f"1ë‹¨ê³„_ì‘ì—…ê³µì •_{selected_ì‘ì—…ëª…}")
            with col2:
                ì‘ì—…ë‚´ìš© = st.text_input("ì‘ì—…ë‚´ìš©", value=ì‘ì—…ë‚´ìš©_ìƒì„¸ì„¤ëª…, key=f"1ë‹¨ê³„_ì‘ì—…ë‚´ìš©_{selected_ì‘ì—…ëª…}")
            
            st.markdown("---")
            
            # 2ë‹¨ê³„: ì‘ì—…ë³„ ì‘ì—…ë¶€í•˜ ë° ì‘ì—…ë¹ˆë„
            st.subheader(f"2ë‹¨ê³„: ì‘ì—…ë³„ ì‘ì—…ë¶€í•˜ ë° ì‘ì—…ë¹ˆë„ - [{selected_ì‘ì—…ëª…}]")
            
            # ì„ íƒëœ ì‘ì—…ëª…ì— í•´ë‹¹í•˜ëŠ” ì²´í¬ë¦¬ìŠ¤íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            checklist_data = []
            if not st.session_state["checklist_df"].empty:
                ì‘ì—…_ì²´í¬ë¦¬ìŠ¤íŠ¸ = st.session_state["checklist_df"][
                    (st.session_state["checklist_df"]["ì‘ì—…ëª…"] == selected_ì‘ì—…ëª…) &
                    (st.session_state["checklist_df"]["íšŒì‚¬ëª…"] == selected_íšŒì‚¬ëª…_ì¡°ê±´)
                ]
                if selected_ì†Œì†_ì¡°ê±´:
                    ì‘ì—…_ì²´í¬ë¦¬ìŠ¤íŠ¸ = ì‘ì—…_ì²´í¬ë¦¬ìŠ¤íŠ¸[ì‘ì—…_ì²´í¬ë¦¬ìŠ¤íŠ¸["ì†Œì†"] == selected_ì†Œì†_ì¡°ê±´]
                
                for idx, row in ì‘ì—…_ì²´í¬ë¦¬ìŠ¤íŠ¸.iterrows():
                    if row["ë‹¨ìœ„ì‘ì—…ëª…"]:
                        ë¶€ë‹´ì‘ì—…í˜¸ = []
                        for i in range(1, 13):
                            if row[f"ë¶€ë‹´ì‘ì—…_{i}í˜¸"] == "O(í•´ë‹¹)":
                                ë¶€ë‹´ì‘ì—…í˜¸.append(f"{i}í˜¸")
                            elif row[f"ë¶€ë‹´ì‘ì—…_{i}í˜¸"] == "â–³(ì ì¬ìœ„í—˜)":
                                ë¶€ë‹´ì‘ì—…í˜¸.append(f"{i}í˜¸(ì ì¬)")
                        
                        checklist_data.append({
                            "ë‹¨ìœ„ì‘ì—…ëª…": row["ë‹¨ìœ„ì‘ì—…ëª…"],
                            "ë¶€ë‹´ì‘ì—…(í˜¸)": ", ".join(ë¶€ë‹´ì‘ì—…í˜¸) if ë¶€ë‹´ì‘ì—…í˜¸ else "ë¯¸í•´ë‹¹",
                            "ì‘ì—…ë¶€í•˜(A)": "",
                            "ì‘ì—…ë¹ˆë„(B)": "",
                            "ì´ì ": 0
                        })
            
            # ë°ì´í„°í”„ë ˆì„ ìƒì„±
            if checklist_data:
                data = pd.DataFrame(checklist_data)
            else:
                data = pd.DataFrame({
                    "ë‹¨ìœ„ì‘ì—…ëª…": ["" for _ in range(3)],
                    "ë¶€ë‹´ì‘ì—…(í˜¸)": ["" for _ in range(3)],
                    "ì‘ì—…ë¶€í•˜(A)": ["" for _ in range(3)],
                    "ì‘ì—…ë¹ˆë„(B)": ["" for _ in range(3)],
                    "ì´ì ": [0 for _ in range(3)],
                })

            ë¶€í•˜ì˜µì…˜ = [
                "",
                "ë§¤ìš°ì‰¬ì›€(1)", 
                "ì‰¬ì›€(2)", 
                "ì•½ê°„ í˜ë“¦(3)", 
                "í˜ë“¦(4)", 
                "ë§¤ìš° í˜ë“¦(5)"
            ]
            ë¹ˆë„ì˜µì…˜ = [
                "",
                "3ê°œì›”ë§ˆë‹¤(1)", 
                "ê°€ë”(2)", 
                "ìì£¼(3)", 
                "ê³„ì†(4)", 
                "ì´ˆê³¼ê·¼ë¬´(5)"
            ]

            column_config = {
                "ì‘ì—…ë¶€í•˜(A)": st.column_config.SelectboxColumn("ì‘ì—…ë¶€í•˜(A)", options=ë¶€í•˜ì˜µì…˜, required=False),
                "ì‘ì—…ë¹ˆë„(B)": st.column_config.SelectboxColumn("ì‘ì—…ë¹ˆë„(B)", options=ë¹ˆë„ì˜µì…˜, required=False),
                "ë‹¨ìœ„ì‘ì—…ëª…": st.column_config.TextColumn("ë‹¨ìœ„ì‘ì—…ëª…"),
                "ë¶€ë‹´ì‘ì—…(í˜¸)": st.column_config.TextColumn("ë¶€ë‹´ì‘ì—…(í˜¸)"),
                "ì´ì ": st.column_config.TextColumn("ì´ì (ìë™ê³„ì‚°)", disabled=True),
            }

            # ë°ì´í„° í¸ì§‘
            edited_df = st.data_editor(
                data,
                num_rows="dynamic",
                use_container_width=True,
                hide_index=True,
                column_config=column_config,
                key=f"ì‘ì—…ì¡°ê±´_data_editor_{selected_ì‘ì—…ëª…}"
            )
            
            # í¸ì§‘ëœ ë°ì´í„°ë¥¼ ì„¸ì…˜ ìƒíƒœì— ì €ì¥
            st.session_state[f"ì‘ì—…ì¡°ê±´_data_{selected_ì‘ì—…ëª…}"] = edited_df
            
            # ì´ì  ìë™ ê³„ì‚° í›„ ë‹¤ì‹œ í‘œì‹œ
            if not edited_df.empty:
                display_df = edited_df.copy()
                for idx in range(len(display_df)):
                    display_df.at[idx, "ì´ì "] = calculate_total_score(display_df.iloc[idx])
                
                st.markdown("##### ê³„ì‚° ê²°ê³¼")
                st.dataframe(
                    display_df,
                    use_container_width=True,
                    hide_index=True,
                    column_config={
                        "ë‹¨ìœ„ì‘ì—…ëª…": st.column_config.TextColumn("ë‹¨ìœ„ì‘ì—…ëª…"),
                        "ë¶€ë‹´ì‘ì—…(í˜¸)": st.column_config.TextColumn("ë¶€ë‹´ì‘ì—…(í˜¸)"),
                        "ì‘ì—…ë¶€í•˜(A)": st.column_config.TextColumn("ì‘ì—…ë¶€í•˜(A)"),
                        "ì‘ì—…ë¹ˆë„(B)": st.column_config.TextColumn("ì‘ì—…ë¹ˆë„(B)"),
                        "ì´ì ": st.column_config.NumberColumn("ì´ì (ìë™ê³„ì‚°)", format="%d"),
                    }
                )
                
                st.info("ğŸ’¡ ì´ì ì€ ì‘ì—…ë¶€í•˜(A) Ã— ì‘ì—…ë¹ˆë„(B)ë¡œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.")
            
            # 3ë‹¨ê³„: ìœ í•´ìš”ì¸í‰ê°€
            st.markdown("---")
            st.subheader(f"3ë‹¨ê³„: ìœ í•´ìš”ì¸í‰ê°€ - [{selected_ì‘ì—…ëª…}]")
            
            # ì‘ì—…ëª…ê³¼ ê·¼ë¡œììˆ˜ ì…ë ¥
            col1, col2 = st.columns(2)
            with col1:
                í‰ê°€_ì‘ì—…ëª… = st.text_input("ì‘ì—…ëª…", value=selected_ì‘ì—…ëª…, key=f"3ë‹¨ê³„_ì‘ì—…ëª…_{selected_ì‘ì—…ëª…}")
            with col2:
                # ì—‘ì…€ì—ì„œ ê·¼ë¡œììˆ˜ ê°€ì ¸ì˜¤ê¸°
                ê·¼ë¡œììˆ˜_ê°’ = ""
                if not st.session_state["checklist_df"].empty:
                    ì‘ì—…_ë°ì´í„° = st.session_state["checklist_df"][
                        (st.session_state["checklist_df"]["ì‘ì—…ëª…"] == selected_ì‘ì—…ëª…) &
                        (st.session_state["checklist_df"]["íšŒì‚¬ëª…"] == selected_íšŒì‚¬ëª…_ì¡°ê±´)
                    ]
                    if selected_ì†Œì†_ì¡°ê±´:
                        ì‘ì—…_ë°ì´í„° = ì‘ì—…_ë°ì´í„°[ì‘ì—…_ë°ì´í„°["ì†Œì†"] == selected_ì†Œì†_ì¡°ê±´]
                    
                    if not ì‘ì—…_ë°ì´í„°.empty and "ì‘ì—…ì ìˆ˜" in ì‘ì—…_ë°ì´í„°.columns:
                        # ì²« ë²ˆì§¸ í–‰ì˜ ì‘ì—…ììˆ˜ ì‚¬ìš©
                        raw_value = ì‘ì—…_ë°ì´í„°.iloc[0].get("ì‘ì—…ì ìˆ˜", "")
                        ê·¼ë¡œììˆ˜_ê°’ = safe_convert(raw_value, str, "")
                        if ê·¼ë¡œììˆ˜_ê°’:
                            st.success(f"âœ… ì‘ì—…ììˆ˜ ìë™ ë¡œë“œë¨")
                
                í‰ê°€_ê·¼ë¡œììˆ˜ = st.text_input("ê·¼ë¡œììˆ˜", value=ê·¼ë¡œììˆ˜_ê°’, key=f"3ë‹¨ê³„_ê·¼ë¡œììˆ˜_{selected_ì‘ì—…ëª…}")
            
            # ì‚¬ì§„ ì—…ë¡œë“œ ë° ì„¤ëª… ì…ë ¥
            st.markdown("#### ì‘ì—… ì‚¬ì§„ ë° ì„¤ëª…")
            
            # ì‚¬ì§„ ê°œìˆ˜ ì„ íƒ
            num_photos = st.number_input("ì‚¬ì§„ ê°œìˆ˜", min_value=1, max_value=10, value=3, key=f"ì‚¬ì§„ê°œìˆ˜_{selected_ì‘ì—…ëª…}")
            
            # ê° ì‚¬ì§„ë³„ë¡œ ì—…ë¡œë“œì™€ ì„¤ëª… ì…ë ¥
            for i in range(num_photos):
                st.markdown(f"##### ì‚¬ì§„ {i+1}")
                col1, col2 = st.columns([1, 2])
                
                with col1:
                    uploaded_file = st.file_uploader(
                        f"ì‚¬ì§„ {i+1} ì—…ë¡œë“œ",
                        type=['png', 'jpg', 'jpeg'],
                        key=f"ì‚¬ì§„_{i+1}_ì—…ë¡œë“œ_{selected_ì‘ì—…ëª…}"
                    )
                    if uploaded_file:
                        st.image(uploaded_file, caption=f"ì‚¬ì§„ {i+1}", use_column_width=True)
                
                with col2:
                    photo_description = st.text_area(
                        f"ì‚¬ì§„ {i+1} ì„¤ëª…",
                        height=150,
                        key=f"ì‚¬ì§„_{i+1}_ì„¤ëª…_{selected_ì‘ì—…ëª…}",
                        placeholder="ì´ ì‚¬ì§„ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..."
                    )
                
                st.markdown("---")
            
            # ì‘ì—…ë³„ë¡œ ê´€ë ¨ëœ ìœ í•´ìš”ì¸ì— ëŒ€í•œ ì›ì¸ë¶„ì„ ì„¹ì…˜ ì¶”ê°€
            render_hazard_analysis_section(selected_ì‘ì—…ëª…, selected_íšŒì‚¬ëª…_ì¡°ê±´, selected_ì†Œì†_ì¡°ê±´)


def render_hazard_analysis_section(selected_ì‘ì—…ëª…, selected_íšŒì‚¬ëª…_ì¡°ê±´, selected_ì†Œì†_ì¡°ê±´):
    """ì‘ì—…ë³„ ìœ í•´ìš”ì¸ ì›ì¸ë¶„ì„ ì„¹ì…˜"""
    st.markdown("---")
    st.subheader(f"ì‘ì—…ë³„ë¡œ ê´€ë ¨ëœ ìœ í•´ìš”ì¸ì— ëŒ€í•œ ì›ì¸ë¶„ì„ - [{selected_ì‘ì—…ëª…}]")
    
    # ì›ì¸ë¶„ì„ ë°ì´í„° ì´ˆê¸°í™” - ì—‘ì…€ì—ì„œ ìë™ ë¡œë“œ
    ì›ì¸ë¶„ì„_key = f"ì›ì¸ë¶„ì„_í•­ëª©_{selected_ì‘ì—…ëª…}"
    if ì›ì¸ë¶„ì„_key not in st.session_state:
        # ì—‘ì…€ì—ì„œ í•´ë‹¹ ì‘ì—…ì˜ ì›ì¸ë¶„ì„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        ì—‘ì…€_ì›ì¸ë¶„ì„_ë°ì´í„° = []
        
        if not st.session_state["checklist_df"].empty:
            # í•´ë‹¹ ì‘ì—…ì˜ ë°ì´í„° í•„í„°ë§
            ì‘ì—…_ë°ì´í„° = st.session_state["checklist_df"][
                (st.session_state["checklist_df"]["ì‘ì—…ëª…"] == selected_ì‘ì—…ëª…) &
                (st.session_state["checklist_df"]["íšŒì‚¬ëª…"] == selected_íšŒì‚¬ëª…_ì¡°ê±´)
            ]
            if selected_ì†Œì†_ì¡°ê±´:
                ì‘ì—…_ë°ì´í„° = ì‘ì—…_ë°ì´í„°[ì‘ì—…_ë°ì´í„°["ì†Œì†"] == selected_ì†Œì†_ì¡°ê±´]
            
            # ë””ë²„ê¹… ì •ë³´
            if not ì‘ì—…_ë°ì´í„°.empty:
                ì›ì¸ë¶„ì„_ì»¬ëŸ¼ë“¤ = [col for col in ì‘ì—…_ë°ì´í„°.columns if "ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„" in col]
                if ì›ì¸ë¶„ì„_ì»¬ëŸ¼ë“¤:
                    st.info(f"ğŸ” ì›ì¸ë¶„ì„ ê´€ë ¨ ì»¬ëŸ¼ {len(ì›ì¸ë¶„ì„_ì»¬ëŸ¼ë“¤)}ê°œ ë°œê²¬")
                    # ì²˜ìŒ ëª‡ ê°œ ì»¬ëŸ¼ëª… í‘œì‹œ
                    st.info(f"ğŸ” ì»¬ëŸ¼ ì˜ˆì‹œ: {ì›ì¸ë¶„ì„_ì»¬ëŸ¼ë“¤[:3]}")
                else:
                    st.warning("âš ï¸ ì›ì¸ë¶„ì„ ê´€ë ¨ ì»¬ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
                    # ì „ì²´ ì»¬ëŸ¼ëª… ì¤‘ ì¼ë¶€ í‘œì‹œ
                    ì „ì²´_ì»¬ëŸ¼ë“¤ = list(ì‘ì—…_ë°ì´í„°.columns)
                    st.info(f"ğŸ” ì „ì²´ ì»¬ëŸ¼ ìˆ˜: {len(ì „ì²´_ì»¬ëŸ¼ë“¤)}ê°œ")
                    st.info(f"ğŸ” ì»¬ëŸ¼ ì˜ˆì‹œ: {ì „ì²´_ì»¬ëŸ¼ë“¤[:10]}")
            
            # ê° í–‰ì—ì„œ ì›ì¸ë¶„ì„ ë°ì´í„° ì¶”ì¶œ
            st.info(f"ğŸ” {len(ì‘ì—…_ë°ì´í„°)}ê°œ í–‰ì—ì„œ ì›ì¸ë¶„ì„ ë°ì´í„° ê²€ìƒ‰ ì¤‘...")
            for idx, row in ì‘ì—…_ë°ì´í„°.iterrows():
                # ìµœëŒ€ 5ê°œì˜ ì›ì¸ë¶„ì„ í•­ëª© í™•ì¸
                for j in range(5):
                    ìœ í˜•_ì»¬ëŸ¼ = f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ìœ í˜•_{j+1}"
                    # ì»¬ëŸ¼ì´ ì¡´ì¬í•˜ê³  ê°’ì´ ìˆëŠ”ì§€ í™•ì¸
                    if ìœ í˜•_ì»¬ëŸ¼ in row and pd.notna(row[ìœ í˜•_ì»¬ëŸ¼]) and str(row[ìœ í˜•_ì»¬ëŸ¼]).strip() != "":
                        ìœ í˜•_ê°’ = str(row[ìœ í˜•_ì»¬ëŸ¼]).strip()
                        st.info(f"ğŸ” ì›ì¸ë¶„ì„ í•­ëª© {j+1} ë°œê²¬: {ìœ í˜•_ê°’}")
                        
                        hazard_entry = {"ìœ í˜•": ìœ í˜•_ê°’}
                        
                        if hazard_entry["ìœ í˜•"] == "ë°˜ë³µë™ì‘":
                            hazard_entry["ë¶€ë‹´ì‘ì—…"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ë¶€ë‹´ì‘ì—…_{j+1}_ë°˜ë³µ", ""), str, "")
                            hazard_entry["ìˆ˜ê³µêµ¬ ì¢…ë¥˜"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ìˆ˜ê³µêµ¬_ì¢…ë¥˜_{j+1}", ""), str, "")
                            hazard_entry["ìˆ˜ê³µêµ¬ ìš©ë„"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ìˆ˜ê³µêµ¬_ìš©ë„_{j+1}", ""), str, "")
                            hazard_entry["ìˆ˜ê³µêµ¬ ë¬´ê²Œ(kg)"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ìˆ˜ê³µêµ¬_ë¬´ê²Œ(kg)_{j+1}", ""), float, 0.0)
                            hazard_entry["ìˆ˜ê³µêµ¬ ì‚¬ìš©ì‹œê°„(ë¶„)"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ìˆ˜ê³µêµ¬_ì‚¬ìš©ì‹œê°„(ë¶„)_{j+1}", ""), str, "")
                            hazard_entry["ë¶€ë‹´ë¶€ìœ„"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ë¶€ë‹´ë¶€ìœ„_{j+1}", ""), str, "")
                            hazard_entry["íšŒë‹¹ ë°˜ë³µì‹œê°„(ì´ˆ/íšŒ)"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ë°˜ë³µ_íšŒë‹¹ì‹œê°„(ì´ˆ/íšŒ)_{j+1}", ""), str, "")
                            hazard_entry["ì‘ì—…ì‹œê°„ë™ì•ˆ ë°˜ë³µíšŸìˆ˜(íšŒ/ì¼)"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ë°˜ë³µ_ì´íšŸìˆ˜(íšŒ/ì¼)_{j+1}", ""), str, "")
                            hazard_entry["ì´ ì‘ì—…ì‹œê°„(ë¶„)"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ë°˜ë³µ_ì´ì‹œê°„(ë¶„)_{j+1}", ""), str, "")
                            # 10í˜¸ ê´€ë ¨ í•„ë“œ
                            hazard_entry["ë¬¼ì²´ ë¬´ê²Œ(kg)_10í˜¸"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ë°˜ë³µ_ë¬¼ì²´ë¬´ê²Œ_10í˜¸(kg)_{j+1}", ""), float, 0.0)
                            hazard_entry["ë¶„ë‹¹ ë°˜ë³µíšŸìˆ˜(íšŒ/ë¶„)_10í˜¸"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ë°˜ë³µ_ë¶„ë‹¹ë°˜ë³µíšŸìˆ˜_10í˜¸(íšŒ/ë¶„)_{j+1}", ""), str, "")
                            # 12í˜¸ ì •ì ìì„¸ ê´€ë ¨ í•„ë“œ
                            hazard_entry["ì‘ì—…ë‚´ìš©_12í˜¸_ì •ì "] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ë°˜ë³µ_ì‘ì—…ë‚´ìš©_12í˜¸_ì •ì _{j+1}", ""), str, "")
                            hazard_entry["ì‘ì—…ì‹œê°„(ë¶„)_12í˜¸_ì •ì "] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ë°˜ë³µ_ì‘ì—…ì‹œê°„_12í˜¸_ì •ì _{j+1}", ""), int, 0)
                            hazard_entry["íœ´ì‹ì‹œê°„(ë¶„)_12í˜¸_ì •ì "] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ë°˜ë³µ_íœ´ì‹ì‹œê°„_12í˜¸_ì •ì _{j+1}", ""), int, 0)
                            hazard_entry["ì¸ì²´ë¶€ë‹´ë¶€ìœ„_12í˜¸_ì •ì "] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ë°˜ë³µ_ì¸ì²´ë¶€ë‹´ë¶€ìœ„_12í˜¸_ì •ì _{j+1}", ""), str, "")
                            
                        elif hazard_entry["ìœ í˜•"] == "ë¶€ìì—°ìŠ¤ëŸ¬ìš´ ìì„¸":
                            hazard_entry["ë¶€ë‹´ì‘ì—…ìì„¸"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ë¶€ë‹´ì‘ì—…ìì„¸_{j+1}", ""), str, "")
                            hazard_entry["íšŒë‹¹ ë°˜ë³µì‹œê°„(ì´ˆ/íšŒ)"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ìì„¸_íšŒë‹¹ì‹œê°„(ì´ˆ/íšŒ)_{j+1}", ""), str, "")
                            hazard_entry["ì‘ì—…ì‹œê°„ë™ì•ˆ ë°˜ë³µíšŸìˆ˜(íšŒ/ì¼)"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ìì„¸_ì´íšŸìˆ˜(íšŒ/ì¼)_{j+1}", ""), str, "")
                            hazard_entry["ì´ ì‘ì—…ì‹œê°„(ë¶„)"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ìì„¸_ì´ì‹œê°„(ë¶„)_{j+1}", ""), str, "")
                            
                        elif hazard_entry["ìœ í˜•"] == "ê³¼ë„í•œ í˜":
                            hazard_entry["ë¶€ë‹´ì‘ì—…"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ë¶€ë‹´ì‘ì—…_{j+1}_í˜", ""), str, "")
                            hazard_entry["ì¤‘ëŸ‰ë¬¼ ëª…ì¹­"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_í˜_ì¤‘ëŸ‰ë¬¼_ëª…ì¹­_{j+1}", ""), str, "")
                            hazard_entry["ì¤‘ëŸ‰ë¬¼ ìš©ë„"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_í˜_ì¤‘ëŸ‰ë¬¼_ìš©ë„_{j+1}", ""), str, "")
                            hazard_entry["ì¤‘ëŸ‰ë¬¼ ë¬´ê²Œ(kg)"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ì¤‘ëŸ‰ë¬¼_ë¬´ê²Œ(kg)_{j+1}", ""), float, 0.0)
                            hazard_entry["í•˜ë£¨ 8ì‹œê°„ë™ì•ˆ ì¤‘ëŸ‰ë¬¼ì„ ë“œëŠ” íšŸìˆ˜(íšŒ)"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_í•˜ë£¨8ì‹œê°„_ì¤‘ëŸ‰ë¬¼_íšŸìˆ˜(íšŒ)_{j+1}", ""), int, 0)
                            hazard_entry["ì·¨ê¸‰ë°©ë²•"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_í˜_ì·¨ê¸‰ë°©ë²•_{j+1}", ""), str, "")
                            hazard_entry["ì¤‘ëŸ‰ë¬¼ ì´ë™ë°©ë²•"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_í˜_ì´ë™ë°©ë²•_{j+1}", ""), str, "")
                            hazard_entry["ì‘ì—…ìê°€ ì§ì ‘ ë°€ê³ /ë‹¹ê¸°ê¸°"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_í˜_ì§ì ‘_ë°€ë‹¹_{j+1}", ""), str, "")
                            hazard_entry["ê¸°íƒ€_ë°€ë‹¹_ì„¤ëª…"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_í˜_ê¸°íƒ€_ë°€ë‹¹_ì„¤ëª…_{j+1}", ""), str, "")
                            hazard_entry["ì‘ì—…ì‹œê°„ë™ì•ˆ ì‘ì—…íšŸìˆ˜(íšŒ/ì¼)"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_í˜_ì´íšŸìˆ˜(íšŒ/ì¼)_{j+1}", ""), str, "")
                            
                        elif hazard_entry["ìœ í˜•"] == "ì ‘ì´‰ìŠ¤íŠ¸ë ˆìŠ¤ ë˜ëŠ” ê¸°íƒ€(ì§„ë™, ë°€ê³  ë‹¹ê¸°ê¸° ë“±)":
                            hazard_entry["ë¶€ë‹´ì‘ì—…"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ë¶€ë‹´ì‘ì—…_{j+1}_ê¸°íƒ€", ""), str, "")
                            if hazard_entry["ë¶€ë‹´ì‘ì—…"] == "(11í˜¸)ì ‘ì´‰ìŠ¤íŠ¸ë ˆìŠ¤":
                                hazard_entry["ì‘ì—…ì‹œê°„(ë¶„)"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ê¸°íƒ€_ì‘ì—…ì‹œê°„(ë¶„)_{j+1}", ""), str, "")
                            elif hazard_entry["ë¶€ë‹´ì‘ì—…"] == "(12í˜¸)ì§„ë™ì‘ì—…(ê·¸ë¼ì¸ë”, ì„íŒ©í„° ë“±)":
                                hazard_entry["ì§„ë™ìˆ˜ê³µêµ¬ëª…"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ê¸°íƒ€_ì§„ë™ìˆ˜ê³µêµ¬ëª…_{j+1}", ""), str, "")
                                hazard_entry["ì§„ë™ìˆ˜ê³µêµ¬ ìš©ë„"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ê¸°íƒ€_ì§„ë™ìˆ˜ê³µêµ¬_ìš©ë„_{j+1}", ""), str, "")
                                hazard_entry["ì‘ì—…ì‹œê°„(ë¶„)_ì§„ë™"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ê¸°íƒ€_ì‘ì—…ì‹œê°„_ì§„ë™_{j+1}", ""), str, "")
                                hazard_entry["ì‘ì—…ë¹ˆë„(ì´ˆ/íšŒ)_ì§„ë™"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ê¸°íƒ€_ì‘ì—…ë¹ˆë„_ì§„ë™_{j+1}", ""), str, "")
                                hazard_entry["ì‘ì—…ëŸ‰(íšŒ/ì¼)_ì§„ë™"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ê¸°íƒ€_ì‘ì—…ëŸ‰_ì§„ë™_{j+1}", ""), str, "")
                                hazard_entry["ìˆ˜ê³µêµ¬ì‚¬ìš©ì‹œ ì§€ì§€ëŒ€ê°€ ìˆëŠ”ê°€?"] = safe_convert(row.get(f"ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ê¸°íƒ€_ì§€ì§€ëŒ€_ì—¬ë¶€_{j+1}", ""), str, "")
                        
                        ì—‘ì…€_ì›ì¸ë¶„ì„_ë°ì´í„°.append(hazard_entry)
        
        # ì—‘ì…€ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ê°’
        if ì—‘ì…€_ì›ì¸ë¶„ì„_ë°ì´í„°:
            st.session_state[ì›ì¸ë¶„ì„_key] = ì—‘ì…€_ì›ì¸ë¶„ì„_ë°ì´í„°
            st.success(f"âœ… ì—‘ì…€ì—ì„œ {len(ì—‘ì…€_ì›ì¸ë¶„ì„_ë°ì´í„°)}ê°œì˜ ì›ì¸ë¶„ì„ í•­ëª©ì„ ìë™ìœ¼ë¡œ ë¡œë“œí–ˆìŠµë‹ˆë‹¤!")
        else:
            st.session_state[ì›ì¸ë¶„ì„_key] = [{"ìœ í˜•": "", "ë¶€ë‹´ì‘ì—…": "", "ë¶€ë‹´ì‘ì—…ìì„¸": ""}]
            st.warning("âš ï¸ ì—‘ì…€ì—ì„œ ì›ì¸ë¶„ì„ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            st.info("ğŸ’¡ ì›ì¸ë¶„ì„ ë°ì´í„°ëŠ” 'ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ìœ í˜•_1', 'ìœ í•´ìš”ì¸_ì›ì¸ë¶„ì„_ìœ í˜•_2' ë“±ì˜ ì»¬ëŸ¼ëª…ìœ¼ë¡œ ì €ì¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.")
    else:
        # ì´ë¯¸ ì„¸ì…˜ì— ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°
        st.info(f"ğŸ“‹ ê¸°ì¡´ ì›ì¸ë¶„ì„ ë°ì´í„° ì‚¬ìš© ì¤‘ ({len(st.session_state[ì›ì¸ë¶„ì„_key])}ê°œ í•­ëª©)")
    
    # ìœ í•´ìš”ì¸ ì›ì¸ë¶„ì„ ì„¹ì…˜
    col_hazard_title, col_hazard_add_btn = st.columns([0.8, 0.2])
    with col_hazard_title:
        st.markdown("**ìœ í•´ìš”ì¸ ì›ì¸ë¶„ì„**")
    with col_hazard_add_btn:
        if st.button(f"í•­ëª© ì¶”ê°€", key=f"add_hazard_analysis_{selected_ì‘ì—…ëª…}"):
            st.session_state[ì›ì¸ë¶„ì„_key].append({"ìœ í˜•": "", "ë¶€ë‹´ì‘ì—…": "", "ë¶€ë‹´ì‘ì—…ìì„¸": ""})
            st.rerun()
    
    current_hazard_analysis_data = st.session_state[ì›ì¸ë¶„ì„_key]
    
    # ìœ í•´ìš”ì¸ ì›ì¸ë¶„ì„ í•­ëª©ë“¤ ì²˜ë¦¬
    for k, hazard_entry in enumerate(current_hazard_analysis_data):
        st.markdown(f"**ìœ í•´ìš”ì¸ ì›ì¸ë¶„ì„ í•­ëª© {k+1}**")
        
        hazard_type_options = ["", "ë°˜ë³µë™ì‘", "ë¶€ìì—°ìŠ¤ëŸ¬ìš´ ìì„¸", "ê³¼ë„í•œ í˜", "ì ‘ì´‰ìŠ¤íŠ¸ë ˆìŠ¤ ë˜ëŠ” ê¸°íƒ€(ì§„ë™, ë°€ê³  ë‹¹ê¸°ê¸° ë“±)"]
        selected_hazard_type_index = hazard_type_options.index(hazard_entry.get("ìœ í˜•", "")) if hazard_entry.get("ìœ í˜•", "") in hazard_type_options else 0
        
        hazard_entry["ìœ í˜•"] = st.selectbox(
            f"[{k+1}] ìœ í•´ìš”ì¸ ìœ í˜• ì„ íƒ", 
            hazard_type_options, 
            index=selected_hazard_type_index, 
            key=f"hazard_type_{k}_{selected_ì‘ì—…ëª…}"
        )

        # ê° ìœ í•´ìš”ì¸ ìœ í˜•ë³„ ì„¸ë¶€ ì…ë ¥ í•„ë“œë“¤
        if hazard_entry["ìœ í˜•"] == "ë°˜ë³µë™ì‘":
            burden_task_options = [
                "",
                "(1í˜¸)í•˜ë£¨ì— 4ì‹œê°„ ì´ìƒ ì§‘ì¤‘ì ìœ¼ë¡œ ìë£Œì…ë ¥ ë“±ì„ ìœ„í•´ í‚¤ë³´ë“œ ë˜ëŠ” ë§ˆìš°ìŠ¤ë¥¼ ì¡°ì‘í•˜ëŠ” ì‘ì—…",
                "(2í˜¸)í•˜ë£¨ì— ì´ 2ì‹œê°„ ì´ìƒ ëª©, ì–´ê¹¨, íŒ”ê¿ˆì¹˜, ì†ëª© ë˜ëŠ” ì†ì„ ì‚¬ìš©í•˜ì—¬ ê°™ì€ ë™ì‘ì„ ë°˜ë³µí•˜ëŠ” ì‘ì—…",
                "(6í˜¸)í•˜ë£¨ì— ì´ 2ì‹œê°„ ì´ìƒ ì§€ì§€ë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ 1kg ì´ìƒì˜ ë¬¼ê±´ì„ í•œì†ì˜ ì†ê°€ë½ìœ¼ë¡œ ì§‘ì–´ ì˜®ê¸°ê±°ë‚˜, 2kg ì´ìƒì— ìƒì‘í•˜ëŠ” í˜ì„ ê°€í•˜ì—¬ í•œì†ì˜ ì†ê°€ë½ìœ¼ë¡œ ë¬¼ê±´ì„ ì¥ëŠ” ì‘ì—…",
                "(7í˜¸)í•˜ë£¨ì— ì´ 2ì‹œê°„ ì´ìƒ ì§€ì§€ë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ 4.5kg ì´ìƒì˜ ë¬¼ê±´ì„ í•œ ì†ìœ¼ë¡œ ë“¤ê±°ë‚˜ ë™ì¼í•œ í˜ìœ¼ë¡œ ì¥ëŠ” ì‘ì—…",
                "(10í˜¸)í•˜ë£¨ì— ì´ 2ì‹œê°„ ì´ìƒ, ë¶„ë‹¹ 2íšŒ ì´ìƒ 4.5kg ì´ìƒì˜ ë¬¼ì²´ë¥¼ ë“œëŠ” ì‘ì—…",
                "(1í˜¸)í•˜ë£¨ì— 4ì‹œê°„ ì´ìƒ ì§‘ì¤‘ì ìœ¼ë¡œ ìë£Œì…ë ¥ ë“±ì„ ìœ„í•´ í‚¤ë³´ë“œ ë˜ëŠ” ë§ˆìš°ìŠ¤ë¥¼ ì¡°ì‘í•˜ëŠ” ì‘ì—…+(12í˜¸)ì •ì ìì„¸(ì¥ì‹œê°„ ì„œì„œ ì‘ì—…, ë˜ëŠ” ì¥ì‹œê°„ ì•‰ì•„ì„œ ì‘ì—…)",
                "(2í˜¸)í•˜ë£¨ì— ì´ 2ì‹œê°„ ì´ìƒ ëª©, ì–´ê¹¨, íŒ”ê¿ˆì¹˜, ì†ëª© ë˜ëŠ” ì†ì„ ì‚¬ìš©í•˜ì—¬ ê°™ì€ ë™ì‘ì„ ë°˜ë³µí•˜ëŠ” ì‘ì—…+(12í˜¸)ì •ì ìì„¸(ì¥ì‹œê°„ ì„œì„œ ì‘ì—…, ë˜ëŠ” ì¥ì‹œê°„ ì•‰ì•„ì„œ ì‘ì—…)",
                "(6í˜¸)í•˜ë£¨ì— ì´ 2ì‹œê°„ ì´ìƒ ì§€ì§€ë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ 1kg ì´ìƒì˜ ë¬¼ê±´ì„ í•œì†ì˜ ì†ê°€ë½ìœ¼ë¡œ ì§‘ì–´ ì˜®ê¸°ê±°ë‚˜, 2kg ì´ìƒì— ìƒì‘í•˜ëŠ” í˜ì„ ê°€í•˜ì—¬ í•œì†ì˜ ì†ê°€ë½ìœ¼ë¡œ ë¬¼ê±´ì„ ì¥ëŠ” ì‘ì—…+(12í˜¸)ì •ì ìì„¸(ì¥ì‹œê°„ ì„œì„œ ì‘ì—…, ë˜ëŠ” ì¥ì‹œê°„ ì•‰ì•„ì„œ ì‘ì—…)",
                "(7í˜¸)í•˜ë£¨ì— ì´ 2ì‹œê°„ ì´ìƒ ì§€ì§€ë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ 4.5kg ì´ìƒì˜ ë¬¼ê±´ì„ í•œ ì†ìœ¼ë¡œ ë“¤ê±°ë‚˜ ë™ì¼í•œ í˜ìœ¼ë¡œ ì¥ëŠ” ì‘ì—…+(12í˜¸)ì •ì ìì„¸(ì¥ì‹œê°„ ì„œì„œ ì‘ì—…, ë˜ëŠ” ì¥ì‹œê°„ ì•‰ì•„ì„œ ì‘ì—…)",
                "(10í˜¸)í•˜ë£¨ì— ì´ 2ì‹œê°„ ì´ìƒ, ë¶„ë‹¹ 2íšŒ ì´ìƒ 4.5kg ì´ìƒì˜ ë¬¼ì²´ë¥¼ ë“œëŠ” ì‘ì—…+(12í˜¸)ì •ì ìì„¸(ì¥ì‹œê°„ ì„œì„œ ì‘ì—…, ë˜ëŠ” ì¥ì‹œê°„ ì•‰ì•„ì„œ ì‘ì—…)"
            ]
            selected_burden_task_index = burden_task_options.index(hazard_entry.get("ë¶€ë‹´ì‘ì—…", "")) if hazard_entry.get("ë¶€ë‹´ì‘ì—…", "") in burden_task_options else 0
            hazard_entry["ë¶€ë‹´ì‘ì—…"] = st.selectbox(f"[{k+1}] ë¶€ë‹´ì‘ì—…", burden_task_options, index=selected_burden_task_index, key=f"burden_task_ë°˜ë³µ_{k}_{selected_ì‘ì—…ëª…}")
            
            hazard_entry["ìˆ˜ê³µêµ¬ ì¢…ë¥˜"] = st.text_input(f"[{k+1}] ìˆ˜ê³µêµ¬ ì¢…ë¥˜", value=hazard_entry.get("ìˆ˜ê³µêµ¬ ì¢…ë¥˜", ""), key=f"ìˆ˜ê³µêµ¬_ì¢…ë¥˜_{k}_{selected_ì‘ì—…ëª…}")
            hazard_entry["ìˆ˜ê³µêµ¬ ìš©ë„"] = st.text_input(f"[{k+1}] ìˆ˜ê³µêµ¬ ìš©ë„", value=hazard_entry.get("ìˆ˜ê³µêµ¬ ìš©ë„", ""), key=f"ìˆ˜ê³µêµ¬_ìš©ë„_{k}_{selected_ì‘ì—…ëª…}")
            hazard_entry["ìˆ˜ê³µêµ¬ ë¬´ê²Œ(kg)"] = st.number_input(f"[{k+1}] ìˆ˜ê³µêµ¬ ë¬´ê²Œ(kg)", value=hazard_entry.get("ìˆ˜ê³µêµ¬ ë¬´ê²Œ(kg)", 0.0), key=f"ìˆ˜ê³µêµ¬_ë¬´ê²Œ_{k}_{selected_ì‘ì—…ëª…}")
            hazard_entry["ìˆ˜ê³µêµ¬ ì‚¬ìš©ì‹œê°„(ë¶„)"] = st.text_input(f"[{k+1}] ìˆ˜ê³µêµ¬ ì‚¬ìš©ì‹œê°„(ë¶„)", value=hazard_entry.get("ìˆ˜ê³µêµ¬ ì‚¬ìš©ì‹œê°„(ë¶„)", ""), key=f"ìˆ˜ê³µêµ¬_ì‚¬ìš©ì‹œê°„_{k}_{selected_ì‘ì—…ëª…}")
            hazard_entry["ë¶€ë‹´ë¶€ìœ„"] = st.text_input(f"[{k+1}] ë¶€ë‹´ë¶€ìœ„", value=hazard_entry.get("ë¶€ë‹´ë¶€ìœ„", ""), key=f"ë¶€ë‹´ë¶€ìœ„_{k}_{selected_ì‘ì—…ëª…}")
            
            # ì´ ì‘ì—…ì‹œê°„ ìë™ ê³„ì‚°ì„ ìœ„í•œ ì…ë ¥ í•„ë“œ
            íšŒë‹¹_ë°˜ë³µì‹œê°„_ì´ˆ_íšŒ = st.text_input(f"[{k+1}] íšŒë‹¹ ë°˜ë³µì‹œê°„(ì´ˆ/íšŒ)", value=hazard_entry.get("íšŒë‹¹ ë°˜ë³µì‹œê°„(ì´ˆ/íšŒ)", ""), key=f"ë°˜ë³µ_íšŒë‹¹ì‹œê°„_{k}_{selected_ì‘ì—…ëª…}")
            ì‘ì—…ì‹œê°„ë™ì•ˆ_ë°˜ë³µíšŸìˆ˜_íšŒ_ì¼ = st.text_input(f"[{k+1}] ì‘ì—…ì‹œê°„ë™ì•ˆ ë°˜ë³µíšŸìˆ˜(íšŒ/ì¼)", value=hazard_entry.get("ì‘ì—…ì‹œê°„ë™ì•ˆ ë°˜ë³µíšŸìˆ˜(íšŒ/ì¼)", ""), key=f"ë°˜ë³µ_ì´íšŸìˆ˜_{k}_{selected_ì‘ì—…ëª…}")
            
            hazard_entry["íšŒë‹¹ ë°˜ë³µì‹œê°„(ì´ˆ/íšŒ)"] = íšŒë‹¹_ë°˜ë³µì‹œê°„_ì´ˆ_íšŒ
            hazard_entry["ì‘ì—…ì‹œê°„ë™ì•ˆ ë°˜ë³µíšŸìˆ˜(íšŒ/ì¼)"] = ì‘ì—…ì‹œê°„ë™ì•ˆ_ë°˜ë³µíšŸìˆ˜_íšŒ_ì¼

            # ì´ ì‘ì—…ì‹œê°„(ë¶„) ìë™ ê³„ì‚°
            calculated_total_work_time = 0.0
            try:
                from utils import parse_value
                parsed_íšŒë‹¹_ë°˜ë³µì‹œê°„ = parse_value(íšŒë‹¹_ë°˜ë³µì‹œê°„_ì´ˆ_íšŒ, val_type=float)
                parsed_ì‘ì—…ì‹œê°„ë™ì•ˆ_ë°˜ë³µíšŸìˆ˜ = parse_value(ì‘ì—…ì‹œê°„ë™ì•ˆ_ë°˜ë³µíšŸìˆ˜_íšŒ_ì¼, val_type=float)
                
                if parsed_íšŒë‹¹_ë°˜ë³µì‹œê°„ > 0 and parsed_ì‘ì—…ì‹œê°„ë™ì•ˆ_ë°˜ë³µíšŸìˆ˜ > 0:
                    calculated_total_work_time = (parsed_íšŒë‹¹_ë°˜ë³µì‹œê°„ * parsed_ì‘ì—…ì‹œê°„ë™ì•ˆ_ë°˜ë³µíšŸìˆ˜) / 60
            except Exception:
                pass

            hazard_entry["ì´ ì‘ì—…ì‹œê°„(ë¶„)"] = st.text_input(
                f"[{k+1}] ì´ ì‘ì—…ì‹œê°„(ë¶„) (ìë™ê³„ì‚°)",
                value=f"{calculated_total_work_time:.2f}" if calculated_total_work_time > 0 else "",
                key=f"ë°˜ë³µ_ì´ì‹œê°„_{k}_{selected_ì‘ì—…ëª…}"
            )

            # 10í˜¸ ì¶”ê°€ í•„ë“œ
            if "(10í˜¸)" in hazard_entry["ë¶€ë‹´ì‘ì—…"]:
                hazard_entry["ë¬¼ì²´ ë¬´ê²Œ(kg)_10í˜¸"] = st.number_input(f"[{k+1}] (10í˜¸)ë¬¼ì²´ ë¬´ê²Œ(kg)", value=hazard_entry.get("ë¬¼ì²´ ë¬´ê²Œ(kg)_10í˜¸", 0.0), key=f"ë¬¼ì²´_ë¬´ê²Œ_10í˜¸_{k}_{selected_ì‘ì—…ëª…}")
                hazard_entry["ë¶„ë‹¹ ë°˜ë³µíšŸìˆ˜(íšŒ/ë¶„)_10í˜¸"] = st.text_input(f"[{k+1}] (10í˜¸)ë¶„ë‹¹ ë°˜ë³µíšŸìˆ˜(íšŒ/ë¶„)", value=hazard_entry.get("ë¶„ë‹¹ ë°˜ë³µíšŸìˆ˜(íšŒ/ë¶„)_10í˜¸", ""), key=f"ë¶„ë‹¹_ë°˜ë³µíšŸìˆ˜_10í˜¸_{k}_{selected_ì‘ì—…ëª…}")
            else:
                hazard_entry["ë¬¼ì²´ ë¬´ê²Œ(kg)_10í˜¸"] = 0.0
                hazard_entry["ë¶„ë‹¹ ë°˜ë³µíšŸìˆ˜(íšŒ/ë¶„)_10í˜¸"] = ""

            # 12í˜¸ ì •ì ìì„¸ ê´€ë ¨ í•„ë“œ
            if "(12í˜¸)ì •ì ìì„¸" in hazard_entry["ë¶€ë‹´ì‘ì—…"]:
                hazard_entry["ì‘ì—…ë‚´ìš©_12í˜¸_ì •ì "] = st.text_input(f"[{k+1}] (ì •ì ìì„¸)ì‘ì—…ë‚´ìš©", value=hazard_entry.get("ì‘ì—…ë‚´ìš©_12í˜¸_ì •ì ", ""), key=f"ë°˜ë³µ_ì‘ì—…ë‚´ìš©_12í˜¸_ì •ì _{k}_{selected_ì‘ì—…ëª…}")
                hazard_entry["ì‘ì—…ì‹œê°„(ë¶„)_12í˜¸_ì •ì "] = st.number_input(f"[{k+1}] (ì •ì ìì„¸)ì‘ì—…ì‹œê°„(ë¶„)", value=hazard_entry.get("ì‘ì—…ì‹œê°„(ë¶„)_12í˜¸_ì •ì ", 0), key=f"ë°˜ë³µ_ì‘ì—…ì‹œê°„_12í˜¸_ì •ì _{k}_{selected_ì‘ì—…ëª…}")
                hazard_entry["íœ´ì‹ì‹œê°„(ë¶„)_12í˜¸_ì •ì "] = st.number_input(f"[{k+1}] (ì •ì ìì„¸)íœ´ì‹ì‹œê°„(ë¶„)", value=hazard_entry.get("íœ´ì‹ì‹œê°„(ë¶„)_12í˜¸_ì •ì ", 0), key=f"ë°˜ë³µ_íœ´ì‹ì‹œê°„_12í˜¸_ì •ì _{k}_{selected_ì‘ì—…ëª…}")
                hazard_entry["ì¸ì²´ë¶€ë‹´ë¶€ìœ„_12í˜¸_ì •ì "] = st.text_input(f"[{k+1}] (ì •ì ìì„¸)ì¸ì²´ë¶€ë‹´ë¶€ìœ„", value=hazard_entry.get("ì¸ì²´ë¶€ë‹´ë¶€ìœ„_12í˜¸_ì •ì ", ""), key=f"ë°˜ë³µ_ì¸ì²´ë¶€ë‹´ë¶€ìœ„_12í˜¸_ì •ì _{k}_{selected_ì‘ì—…ëª…}")
            else:
                hazard_entry["ì‘ì—…ë‚´ìš©_12í˜¸_ì •ì "] = ""
                hazard_entry["ì‘ì—…ì‹œê°„(ë¶„)_12í˜¸_ì •ì "] = 0
                hazard_entry["íœ´ì‹ì‹œê°„(ë¶„)_12í˜¸_ì •ì "] = 0
                hazard_entry["ì¸ì²´ë¶€ë‹´ë¶€ìœ„_12í˜¸_ì •ì "] = ""

        elif hazard_entry["ìœ í˜•"] == "ë¶€ìì—°ìŠ¤ëŸ¬ìš´ ìì„¸":
            burden_pose_options = [
                "",
                "(3í˜¸)í•˜ë£¨ì— ì´ 2ì‹œê°„ ì´ìƒ ë¨¸ë¦¬ ìœ„ì— ì†ì´ ìˆê±°ë‚˜, íŒ”ê¿ˆì¹˜ê°€ ì–´ê¹¨ìœ„ì— ìˆê±°ë‚˜, íŒ”ê¿ˆì¹˜ë¥¼ ëª¸í†µìœ¼ë¡œë¶€í„° ë“¤ê±°ë‚˜, íŒ”ê¿ˆì¹˜ë¥¼ ëª¸í†µë’¤ìª½ì— ìœ„ì¹˜í•˜ë„ë¡ í•˜ëŠ” ìƒíƒœì—ì„œ ì´ë£¨ì–´ì§€ëŠ” ì‘ì—…",
                "(4í˜¸)ì§€ì§€ë˜ì§€ ì•Šì€ ìƒíƒœì´ê±°ë‚˜ ì„ì˜ë¡œ ìì„¸ë¥¼ ë°”ê¿€ ìˆ˜ ì—†ëŠ” ì¡°ê±´ì—ì„œ, í•˜ë£¨ì— ì´ 2ì‹œê°„ ì´ìƒ ëª©ì´ë‚˜ í—ˆë¦¬ë¥¼ êµ¬ë¶€ë¦¬ê±°ë‚˜ íŠ¸ëŠ” ìƒíƒœì—ì„œ ì´ë£¨ì–´ì§€ëŠ” ì‘ì—…",
                "(5í˜¸)í•˜ë£¨ì— ì´ 2ì‹œê°„ ì´ìƒ ìª¼ê·¸ë¦¬ê³  ì•‰ê±°ë‚˜ ë¬´ë¦ì„ êµ½íŒ ìì„¸ì—ì„œ ì´ë£¨ì–´ì§€ëŠ” ì‘ì—…"
            ]
            selected_burden_pose_index = burden_pose_options.index(hazard_entry.get("ë¶€ë‹´ì‘ì—…ìì„¸", "")) if hazard_entry.get("ë¶€ë‹´ì‘ì—…ìì„¸", "") in burden_pose_options else 0
            hazard_entry["ë¶€ë‹´ì‘ì—…ìì„¸"] = st.selectbox(f"[{k+1}] ë¶€ë‹´ì‘ì—…ìì„¸", burden_pose_options, index=selected_burden_pose_index, key=f"burden_pose_{k}_{selected_ì‘ì—…ëª…}")
            
            hazard_entry["íšŒë‹¹ ë°˜ë³µì‹œê°„(ì´ˆ/íšŒ)"] = st.text_input(f"[{k+1}] íšŒë‹¹ ë°˜ë³µì‹œê°„(ì´ˆ/íšŒ)", value=hazard_entry.get("íšŒë‹¹ ë°˜ë³µì‹œê°„(ì´ˆ/íšŒ)", ""), key=f"ìì„¸_íšŒë‹¹ì‹œê°„_{k}_{selected_ì‘ì—…ëª…}")
            hazard_entry["ì‘ì—…ì‹œê°„ë™ì•ˆ ë°˜ë³µíšŸìˆ˜(íšŒ/ì¼)"] = st.text_input(f"[{k+1}] ì‘ì—…ì‹œê°„ë™ì•ˆ ë°˜ë³µíšŸìˆ˜(íšŒ/ì¼)", value=hazard_entry.get("ì‘ì—…ì‹œê°„ë™ì•ˆ ë°˜ë³µíšŸìˆ˜(íšŒ/ì¼)", ""), key=f"ìì„¸_ì´íšŸìˆ˜_{k}_{selected_ì‘ì—…ëª…}")
            hazard_entry["ì´ ì‘ì—…ì‹œê°„(ë¶„)"] = st.text_input(f"[{k+1}] ì´ ì‘ì—…ì‹œê°„(ë¶„)", value=hazard_entry.get("ì´ ì‘ì—…ì‹œê°„(ë¶„)", ""), key=f"ìì„¸_ì´ì‹œê°„_{k}_{selected_ì‘ì—…ëª…}")

        elif hazard_entry["ìœ í˜•"] == "ê³¼ë„í•œ í˜":
            burden_force_options = [
                "",
                "(8í˜¸)í•˜ë£¨ì— 10íšŒ ì´ìƒ 25kg ì´ìƒì˜ ë¬¼ì²´ë¥¼ ë“œëŠ” ì‘ì—…",
                "(9í˜¸)í•˜ë£¨ì— 25íšŒ ì´ìƒ 10kg ì´ìƒì˜ ë¬¼ì²´ë¥¼ ë¬´ë¦ ì•„ë˜ì—ì„œ ë“¤ê±°ë‚˜, ì–´ê¹¨ ìœ„ì—ì„œ ë“¤ê±°ë‚˜, íŒ”ì„ ë»—ì€ ìƒíƒœì—ì„œ ë“œëŠ” ì‘ì—…",
                "(12í˜¸)ë°€ê¸°/ë‹¹ê¸°ê¸° ì‘ì—…",
                "(8í˜¸)í•˜ë£¨ì— 10íšŒ ì´ìƒ 25kg ì´ìƒì˜ ë¬¼ì²´ë¥¼ ë“œëŠ” ì‘ì—…+(12í˜¸)ë°€ê¸°/ë‹¹ê¸°ê¸° ì‘ì—…",
                "(9í˜¸)í•˜ë£¨ì— 25íšŒ ì´ìƒ 10kg ì´ìƒì˜ ë¬¼ì²´ë¥¼ ë¬´ë¦ ì•„ë˜ì—ì„œ ë“¤ê±°ë‚˜, ì–´ê¹¨ ìœ„ì—ì„œ ë“¤ê±°ë‚˜, íŒ”ì„ ë»—ì€ ìƒíƒœì—ì„œ ë“œëŠ” ì‘ì—…+(12í˜¸)ë°€ê¸°/ë‹¹ê¸°ê¸° ì‘ì—…"
            ]
            selected_burden_force_index = burden_force_options.index(hazard_entry.get("ë¶€ë‹´ì‘ì—…", "")) if hazard_entry.get("ë¶€ë‹´ì‘ì—…", "") in burden_force_options else 0
            hazard_entry["ë¶€ë‹´ì‘ì—…"] = st.selectbox(f"[{k+1}] ë¶€ë‹´ì‘ì—…", burden_force_options, index=selected_burden_force_index, key=f"burden_force_{k}_{selected_ì‘ì—…ëª…}")
            
            hazard_entry["ì¤‘ëŸ‰ë¬¼ ëª…ì¹­"] = st.text_input(f"[{k+1}] ì¤‘ëŸ‰ë¬¼ ëª…ì¹­", value=hazard_entry.get("ì¤‘ëŸ‰ë¬¼ ëª…ì¹­", ""), key=f"í˜_ì¤‘ëŸ‰ë¬¼_ëª…ì¹­_{k}_{selected_ì‘ì—…ëª…}")
            hazard_entry["ì¤‘ëŸ‰ë¬¼ ìš©ë„"] = st.text_input(f"[{k+1}] ì¤‘ëŸ‰ë¬¼ ìš©ë„", value=hazard_entry.get("ì¤‘ëŸ‰ë¬¼ ìš©ë„", ""), key=f"í˜_ì¤‘ëŸ‰ë¬¼_ìš©ë„_{k}_{selected_ì‘ì—…ëª…}")
            hazard_entry["ì¤‘ëŸ‰ë¬¼ ë¬´ê²Œ(kg)"] = st.number_input(f"[{k+1}] ì¤‘ëŸ‰ë¬¼ ë¬´ê²Œ(kg)", value=hazard_entry.get("ì¤‘ëŸ‰ë¬¼ ë¬´ê²Œ(kg)", 0.0), key=f"ì¤‘ëŸ‰ë¬¼_ë¬´ê²Œ_ê¸°ë³¸_{k}_{selected_ì‘ì—…ëª…}")
            hazard_entry["í•˜ë£¨ 8ì‹œê°„ë™ì•ˆ ì¤‘ëŸ‰ë¬¼ì„ ë“œëŠ” íšŸìˆ˜(íšŒ)"] = st.number_input(f"[{k+1}] í•˜ë£¨ 8ì‹œê°„ë™ì•ˆ ì¤‘ëŸ‰ë¬¼ì„ ë“œëŠ” íšŸìˆ˜(íšŒ)", value=hazard_entry.get("í•˜ë£¨ 8ì‹œê°„ë™ì•ˆ ì¤‘ëŸ‰ë¬¼ì„ ë“œëŠ” íšŸìˆ˜(íšŒ)", 0), min_value=0, step=1, key=f"ì¤‘ëŸ‰ë¬¼_íšŸìˆ˜_{k}_{selected_ì‘ì—…ëª…}")
            
            ì·¨ê¸‰ë°©ë²•_options = ["", "ì§ì ‘ ì·¨ê¸‰", "í¬ë ˆì¸ ì‚¬ìš©"]
            selected_ì·¨ê¸‰ë°©ë²•_index = ì·¨ê¸‰ë°©ë²•_options.index(hazard_entry.get("ì·¨ê¸‰ë°©ë²•", "")) if hazard_entry.get("ì·¨ê¸‰ë°©ë²•", "") in ì·¨ê¸‰ë°©ë²•_options else 0
            hazard_entry["ì·¨ê¸‰ë°©ë²•"] = st.selectbox(f"[{k+1}] ì·¨ê¸‰ë°©ë²•", ì·¨ê¸‰ë°©ë²•_options, index=selected_ì·¨ê¸‰ë°©ë²•_index, key=f"í˜_ì·¨ê¸‰ë°©ë²•_{k}_{selected_ì‘ì—…ëª…}")

            if hazard_entry["ì·¨ê¸‰ë°©ë²•"] == "ì§ì ‘ ì·¨ê¸‰":
                ì´ë™ë°©ë²•_options = ["", "1ì¸ ì§ì ‘ì´ë™", "2ì¸1ì¡° ì§ì ‘ì´ë™", "ì—¬ëŸ¬ëª… ì§ì ‘ì´ë™", "ì´ë™ëŒ€ì°¨(ì¸ë ¥ì´ë™)", "ì´ë™ëŒ€ì°¨(ì „ë ¥ì´ë™)", "ì§€ê²Œì°¨"]
                selected_ì´ë™ë°©ë²•_index = ì´ë™ë°©ë²•_options.index(hazard_entry.get("ì¤‘ëŸ‰ë¬¼ ì´ë™ë°©ë²•", "")) if hazard_entry.get("ì¤‘ëŸ‰ë¬¼ ì´ë™ë°©ë²•", "") in ì´ë™ë°©ë²•_options else 0
                hazard_entry["ì¤‘ëŸ‰ë¬¼ ì´ë™ë°©ë²•"] = st.selectbox(f"[{k+1}] ì¤‘ëŸ‰ë¬¼ ì´ë™ë°©ë²•", ì´ë™ë°©ë²•_options, index=selected_ì´ë™ë°©ë²•_index, key=f"í˜_ì´ë™ë°©ë²•_{k}_{selected_ì‘ì—…ëª…}")
                
                if hazard_entry["ì¤‘ëŸ‰ë¬¼ ì´ë™ë°©ë²•"] == "ì´ë™ëŒ€ì°¨(ì¸ë ¥ì´ë™)":
                    ì§ì ‘_ë°€ë‹¹_options = ["", "ì‘ì—…ìê°€ ì§ì ‘ ë°”í€´ë‹¬ë¦° ì´ë™ëŒ€ì°¨ë¥¼ ë°€ê³ /ë‹¹ê¸°ê¸°", "ìë™ì´ë™ëŒ€ì°¨(AGV)", "ê¸°íƒ€"]
                    selected_ì§ì ‘_ë°€ë‹¹_index = ì§ì ‘_ë°€ë‹¹_options.index(hazard_entry.get("ì‘ì—…ìê°€ ì§ì ‘ ë°€ê³ /ë‹¹ê¸°ê¸°", "")) if hazard_entry.get("ì‘ì—…ìê°€ ì§ì ‘ ë°€ê³ /ë‹¹ê¸°ê¸°", "") in ì§ì ‘_ë°€ë‹¹_options else 0
                    hazard_entry["ì‘ì—…ìê°€ ì§ì ‘ ë°€ê³ /ë‹¹ê¸°ê¸°"] = st.selectbox(f"[{k+1}] ì‘ì—…ìê°€ ì§ì ‘ ë°€ê³ /ë‹¹ê¸°ê¸°", ì§ì ‘_ë°€ë‹¹_options, index=selected_ì§ì ‘_ë°€ë‹¹_index, key=f"í˜_ì§ì ‘_ë°€ë‹¹_{k}_{selected_ì‘ì—…ëª…}")
                    
                    if hazard_entry["ì‘ì—…ìê°€ ì§ì ‘ ë°€ê³ /ë‹¹ê¸°ê¸°"] == "ê¸°íƒ€":
                        hazard_entry["ê¸°íƒ€_ë°€ë‹¹_ì„¤ëª…"] = st.text_input(f"[{k+1}] ê¸°íƒ€ ë°€ê¸°/ë‹¹ê¸°ê¸° ì„¤ëª…", value=hazard_entry.get("ê¸°íƒ€_ë°€ë‹¹_ì„¤ëª…", ""), key=f"í˜_ê¸°íƒ€_ë°€ë‹¹_ì„¤ëª…_{k}_{selected_ì‘ì—…ëª…}")
                    else:
                        hazard_entry["ê¸°íƒ€_ë°€ë‹¹_ì„¤ëª…"] = ""
                else:
                    hazard_entry["ì‘ì—…ìê°€ ì§ì ‘ ë°€ê³ /ë‹¹ê¸°ê¸°"] = ""
                    hazard_entry["ê¸°íƒ€_ë°€ë‹¹_ì„¤ëª…"] = ""
            else:
                hazard_entry["ì¤‘ëŸ‰ë¬¼ ì´ë™ë°©ë²•"] = ""
                hazard_entry["ì‘ì—…ìê°€ ì§ì ‘ ë°€ê³ /ë‹¹ê¸°ê¸°"] = ""
                hazard_entry["ê¸°íƒ€_ë°€ë‹¹_ì„¤ëª…"] = ""

            if "(12í˜¸)ë°€ê¸°/ë‹¹ê¸°ê¸° ì‘ì—…" not in hazard_entry["ë¶€ë‹´ì‘ì—…"]:
                # ë°€ê¸°/ë‹¹ê¸°ê¸° ì‘ì—…ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê¸°ì¡´ í•„ë“œë“¤ ìˆ¨ê¹€ ì²˜ë¦¬ (ì´ë¯¸ ìœ„ì—ì„œ ì…ë ¥ë°›ìŒ)
                pass
            else:
                # ë°€ê¸°/ë‹¹ê¸°ê¸° ì‘ì—… ì„ íƒ ì‹œ ì¤‘ëŸ‰ë¬¼ ê´€ë ¨ í•„ë“œë“¤ ì´ˆê¸°í™”
                hazard_entry["ì¤‘ëŸ‰ë¬¼ ë¬´ê²Œ(kg)"] = 0.0
                hazard_entry["í•˜ë£¨ 8ì‹œê°„ë™ì•ˆ ì¤‘ëŸ‰ë¬¼ì„ ë“œëŠ” íšŸìˆ˜(íšŒ)"] = 0

        elif hazard_entry["ìœ í˜•"] == "ì ‘ì´‰ìŠ¤íŠ¸ë ˆìŠ¤ ë˜ëŠ” ê¸°íƒ€(ì§„ë™, ë°€ê³  ë‹¹ê¸°ê¸° ë“±)":
            burden_other_options = [
                "",
                "(11í˜¸)í•˜ë£¨ì— ì´ 2ì‹œê°„ ì´ìƒ ì‹œê°„ë‹¹ 10íšŒ ì´ìƒ ì† ë˜ëŠ” ë¬´ë¦ì„ ì‚¬ìš©í•˜ì—¬ ë°˜ë³µì ìœ¼ë¡œ ì¶©ê²©ì„ ê°€í•˜ëŠ” ì‘ì—…",
                "(12í˜¸)ì§„ë™ì‘ì—…(ê·¸ë¼ì¸ë”, ì„íŒ©í„° ë“±)"
            ]
            selected_burden_other_index = burden_other_options.index(hazard_entry.get("ë¶€ë‹´ì‘ì—…", "")) if hazard_entry.get("ë¶€ë‹´ì‘ì—…", "") in burden_other_options else 0
            hazard_entry["ë¶€ë‹´ì‘ì—…"] = st.selectbox(f"[{k+1}] ë¶€ë‹´ì‘ì—…", burden_other_options, index=selected_burden_other_index, key=f"burden_other_{k}_{selected_ì‘ì—…ëª…}")

            if hazard_entry["ë¶€ë‹´ì‘ì—…"] == "(11í˜¸)í•˜ë£¨ì— ì´ 2ì‹œê°„ ì´ìƒ ì‹œê°„ë‹¹ 10íšŒ ì´ìƒ ì† ë˜ëŠ” ë¬´ë¦ì„ ì‚¬ìš©í•˜ì—¬ ë°˜ë³µì ìœ¼ë¡œ ì¶©ê²©ì„ ê°€í•˜ëŠ” ì‘ì—…":
                hazard_entry["ì‘ì—…ì‹œê°„(ë¶„)"] = st.text_input(f"[{k+1}] ì‘ì—…ì‹œê°„(ë¶„)", value=hazard_entry.get("ì‘ì—…ì‹œê°„(ë¶„)", ""), key=f"ê¸°íƒ€_ì‘ì—…ì‹œê°„_{k}_{selected_ì‘ì—…ëª…}")
            else:
                hazard_entry["ì‘ì—…ì‹œê°„(ë¶„)"] = ""

            if hazard_entry["ë¶€ë‹´ì‘ì—…"] == "(12í˜¸)ì§„ë™ì‘ì—…(ê·¸ë¼ì¸ë”, ì„íŒ©í„° ë“±)":
                st.markdown("**(12í˜¸) ì„¸ë¶€ ìœ í˜•ì— ëŒ€í•œ ì¶”ê°€ ì •ë³´ (ì„ íƒì  ì…ë ¥)**")
                hazard_entry["ì§„ë™ìˆ˜ê³µêµ¬ëª…"] = st.text_input(f"[{k+1}] ì§„ë™ìˆ˜ê³µêµ¬ëª…", value=hazard_entry.get("ì§„ë™ìˆ˜ê³µêµ¬ëª…", ""), key=f"ê¸°íƒ€_ì§„ë™ìˆ˜ê³µêµ¬ëª…_{k}_{selected_ì‘ì—…ëª…}")
                hazard_entry["ì§„ë™ìˆ˜ê³µêµ¬ ìš©ë„"] = st.text_input(f"[{k+1}] ì§„ë™ìˆ˜ê³µêµ¬ ìš©ë„", value=hazard_entry.get("ì§„ë™ìˆ˜ê³µêµ¬ ìš©ë„", ""), key=f"ê¸°íƒ€_ì§„ë™ìˆ˜ê³µêµ¬_ìš©ë„_{k}_{selected_ì‘ì—…ëª…}")
                hazard_entry["ì‘ì—…ì‹œê°„(ë¶„)_ì§„ë™"] = st.text_input(f"[{k+1}] ì‘ì—…ì‹œê°„(ë¶„)", value=hazard_entry.get("ì‘ì—…ì‹œê°„(ë¶„)_ì§„ë™", ""), key=f"ê¸°íƒ€_ì‘ì—…ì‹œê°„_ì§„ë™_{k}_{selected_ì‘ì—…ëª…}")
                hazard_entry["ì‘ì—…ë¹ˆë„(ì´ˆ/íšŒ)_ì§„ë™"] = st.text_input(f"[{k+1}] ì‘ì—…ë¹ˆë„(ì´ˆ/íšŒ)", value=hazard_entry.get("ì‘ì—…ë¹ˆë„(ì´ˆ/íšŒ)_ì§„ë™", ""), key=f"ê¸°íƒ€_ì‘ì—…ë¹ˆë„_ì§„ë™_{k}_{selected_ì‘ì—…ëª…}")
                hazard_entry["ì‘ì—…ëŸ‰(íšŒ/ì¼)_ì§„ë™"] = st.text_input(f"[{k+1}] ì‘ì—…ëŸ‰(íšŒ/ì¼)", value=hazard_entry.get("ì‘ì—…ëŸ‰(íšŒ/ì¼)_ì§„ë™", ""), key=f"ê¸°íƒ€_ì‘ì—…ëŸ‰_ì§„ë™_{k}_{selected_ì‘ì—…ëª…}")
                
                ì§€ì§€ëŒ€_options = ["", "ì˜ˆ", "ì•„ë‹ˆì˜¤"]
                selected_ì§€ì§€ëŒ€_index = ì§€ì§€ëŒ€_options.index(hazard_entry.get("ìˆ˜ê³µêµ¬ì‚¬ìš©ì‹œ ì§€ì§€ëŒ€ê°€ ìˆëŠ”ê°€?", "")) if hazard_entry.get("ìˆ˜ê³µêµ¬ì‚¬ìš©ì‹œ ì§€ì§€ëŒ€ê°€ ìˆëŠ”ê°€?", "") in ì§€ì§€ëŒ€_options else 0
                hazard_entry["ìˆ˜ê³µêµ¬ì‚¬ìš©ì‹œ ì§€ì§€ëŒ€ê°€ ìˆëŠ”ê°€?"] = st.selectbox(f"[{k+1}] ìˆ˜ê³µêµ¬ì‚¬ìš©ì‹œ ì§€ì§€ëŒ€ê°€ ìˆëŠ”ê°€?", ì§€ì§€ëŒ€_options, index=selected_ì§€ì§€ëŒ€_index, key=f"ê¸°íƒ€_ì§€ì§€ëŒ€_ì—¬ë¶€_{k}_{selected_ì‘ì—…ëª…}")
        
        # í˜„ì¬ í•­ëª©ì˜ ë³€ê²½ì‚¬í•­ì„ ì„¸ì…˜ ìƒíƒœì— ë°˜ì˜
        st.session_state[ì›ì¸ë¶„ì„_key][k] = hazard_entry

        # ì‚­ì œ ë²„íŠ¼ (ì²« ë²ˆì§¸ í•­ëª©ì€ ì‚­ì œ ë¶ˆê°€)
        if k > 0 or len(current_hazard_analysis_data) > 1:
            col_delete_btn, _ = st.columns([0.2, 0.8])
            with col_delete_btn:
                if st.button(f"[{k+1}] í•­ëª© ì‚­ì œ", key=f"delete_hazard_analysis_{k}_{selected_ì‘ì—…ëª…}"):
                    st.session_state[ì›ì¸ë¶„ì„_key].pop(k)
                    st.rerun()

        st.markdown("---")